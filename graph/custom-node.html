<script src="sites/default/files/sigmajs/sigma.min.js"></script>
<script src="sites/default/files/sigmajs/sigma.parsers.json.js"></script>
<script src="sites/default/files/sigmajs/worker.js"></script>
<script src="sites/default/files/sigmajs/supervisor.js"></script>
<script src="sites/default/files/sigmajs/settings.js"></script>
<script src="sites/default/files/sigmajs/sigma.canvas.edges.labels.def.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

<div id="container">
<style type="text/css">#graph-container {
   width:100%;
   height: 700px;
    }
</style>
<div id="graph-container">&nbsp;</div>
</div>
<script>

var colors = [
 '#E91E63',
 '#FF5722',
 '#FF9800',
 '#9E9D24',
 '#689F38',
 '#009688',
 '#0097A7',
 '#0288D1',
 '#3F51B5'
];
var A = $.getJSON('/graphnodes');
var B = $.getJSON('/graphedges');
var data;
var s, i, l;

$.when(A,B).done(function(aResult, bResult){//when all request are successful
  data = Object.assign({}, aResult[0], bResult[0]);

  l = data.nodes.length;
 
  for (i = 0; i < l; i++) {
    data.nodes[i].x = Math.random() * 10; // 100 * Math.cos(2 * i * Math.PI / l);
    data.nodes[i].y = Math.random() * 10; // 100 * Math.sin(2 * i * Math.PI / l);
    data.nodes[i].size =  data.nodes[i].rids+3;
    data.nodes[i].color = colors[data.nodes[i].rating-1];
  }

  for (i = 0; i < data.edges.length; i++) {
    data.edges[i].size =  data.edges[i].rating / 2;
    data.edges[i].color = '#90A4AE';
    data.edges[i].hover_color = '#263238';
  }

  s = new sigma({
    graph: data,
     renderers: [{
      container: document.getElementById('graph-container'),
      type: 'canvas' // sigma.renderers.canvas works as well
    }],
    settings: {
      defaultEdgeColor: '#607D8B',
      defaultLabelColor: '#37474F',
      defaultNodeColor: '#607D8B',
      defaultNodeBorderColor: '#37474F',
      defaultLabelSize: 12,
      labelHoverShadowColor: '#263238',
      nodeHoverColor: 'default',
      defaultNodeHoverColor: '#263238',
      defaultHoverLabelBGColor: '#ECEFF1',
      defaultLabelHoverColor: '#263238',
      defaultEdgeHoverColor: '#263238',
      edgeHoverSizeRatio: 1,
      enableHovering: true,
      enableEdgeHovering: true,
      drawEdgeLabels: true,
      edgeHoverExtremities: true,
      edgeLabelSize: 'proportional',
      doubleClickEnabled: false,
      minEdgeSize: 0.5,
      maxEdgeSize: 4,
      edgeHoverColor: 'edge',
      edgeHoverExtremities: true

    }
  });
  // Start the ForceAtlas2 algorithm:
  s.startForceAtlas2({
  worker: true, 
  barnesHutOptimize: true,
  startingIterations: 50,
  iterationsPerRender: 1,
  slowDown: 10,
  gravity: 10});

  setTimeout(function(){ s.stopForceAtlas2(); }, 10000);

});


/*
var loadFile = function (filePath, done) {
    var xhr = new XMLHttpRequest();
    xhr.onload = function () { return done(this.responseText) }
    xhr.open("GET", filePath, true);
    xhr.send();
}

var files = ["relgraph.json"];
var data = {};
files.forEach(function (file, i) {
  loadFile(file, function (responseText) {
 //     data[i] = JSON.parse(responseText);
 //     data = JSON.parse(responseText);
 //     data[p] = JSON.parse(responseText)[i][p];
      data = Object.assign(data, JSON.parse(responseText));
      console.log("check");
  })
})

console.log(data.nodes.length);
// console.log(data);


function loadJSON(path, callback) {   
  var xobj = new XMLHttpRequest();
      xobj.overrideMimeType("application/json");
  xobj.open('GET', path, true); // Replace 'my_data' with the path to your file
  xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 && xobj.status == "200") {
          // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
          callback(xobj.responseText);
        }
  };
  xobj.send(null);  
}      
loadJSON('relgraph.json',function(response) {
  // Parse JSON string into object
    g = JSON.parse(response);
});

  s.bind('overNode outNode clickNode doubleClickNode rightClickNode', function(e) {
  });
  s.bind('overEdge outEdge clickEdge doubleClickEdge rightClickEdge', function(e) {
  });
  s.bind('clickStage', function(e) {
  });
  s.bind('doubleClickStage rightClickStage', function(e) {
  });
*/

</script>